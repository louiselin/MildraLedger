<!DOCTYPE html>
<html>
    
    <head>
        <%- include('base/head') %>
        <link rel='stylesheet' href='/stylesheets/style.css' />
        
        <style>
            #chartdiv {
                width	: 100%;
                height	: 500px;
                margin-left:0%;
            }
        </style>
        
    </head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
            
            <body>
                
                <header>
                    <%- include('base/header', user); %>
                </header>
                
                <div class="container">
                    <div class="jumbotron text-center">
                        <h1><span class="fa fa-home fa-fw"></span> Ledger</h1>
                        
                    </div>
                </div>
                
                <!-- Resources -->
                <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
                <script src="https://www.amcharts.com/lib/3/serial.js"></script>
                <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
                <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
                <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
                
                <div class="w3-container">
                    
                    <button onclick="myFunction()" class="w3-btn w3-blue" style="width:10%" >資料分析</button>
                    <button onclick="myFunctionTwo()" class="w3-btn w3-blue" style="width:10%" >交易細項</button>
                    
                    
                    <div id="Demo" class="w3-hide">
                        
                        
                        <div class="page-header text-center">
                            
                            
                            <ul class="nav nav-pills">
                                <li class="nav-item"><a id="e1" href="#">Show transactions</a></li>
                                <li class="nav-item"><a id="e2" href="#">Show write-off entries</a></li>
                            </ul>
                            
                            
                            <div id="tt">
                                <h1 class="text-center">TRANSACTIONS ENTITY</h1><br>
                                <table id="example1" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
                                            <th data-name="tx_id">Transaction ID</th>
                                            <th data-name="tx_type">Transaction Type</th>
                                            <th data-name="cashier_address">Cashier Address</th>
                                            <th data-name="amount">Amount</th>
                                            <th data-name="description">Description</th>
                                            <th data-name="timestamp">Timestamp</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr>
                                            <th data-name="tx_id">Transaction ID</th>
                                            <th data-name="tx_type">Transaction Type</th>
                                            <th data-name="cashier_address">Cashier Address</th>
                                            <th data-name="amount">Amount</th>
                                            <th data-name="description">Description</th>
                                            <th data-name="timestamp">Timestamp</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            
                            <div id="wt" style="display : none; ">
                                <h1 class="text-center">WRITE-OFF ENTITY</h1><br>
                                <table id="example2" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                    <div id='tab2'>
                                        <thead>
                                            <tr>
                                                <th data-name="tx_id">Writeoff ID</th>
                                                <th data-name="tx_type">Transaction ID</th>
                                                <th data-name="cashier_address">Cashier Address</th>
                                                <th data-name="description">Description</th>
                                                <th data-name="timestamp">Timestamp</th>
                                            </tr>
                                        </thead>
                                        <tfoot>
                                            <tr>
                                                <th data-name="tx_id">Writeoff ID</th>
                                                <th data-name="tx_type">Transaction ID</th>
                                                <th data-name="cashier_address">Cashier Address</th>
                                                <th data-name="description">Description</th>
                                                <th data-name="timestamp">Timestamp</th>
                                            </tr>
                                        </tfoot>
                                    </div>
                                </table>
                            </div>
                        </div>
                        
                        
                    </div>
                    
                    
                    <script type="text/javascript">
                        
                        $(document).ready(function() {
                                          var table1 = $('#example1').dataTable({
                                                                                ajax: {
                                                                                url:'/api/txs',
                                                                                dataSrc: ''
                                                                                },
                                                                                columns: [
                                                                                          {data: 'tx_id'},
                                                                                          {data: function (source, type, val){
                                                                                          return source.tx_type === 0
                                                                                          ? 'Income'
                                                                                          : 'Expense';
                                                                                          }},
                                                                                          {data: 'cashier_address'},
                                                                                          {data: 'amount'},
                                                                                          {data: 'description'},
                                                                                          {data: function(source, type, val){
                                                                                          var dt = new Date(source.timestamp *1000);
                                                                                          return dt.toString();
                                                                                          }}
                                                                                          ]
                                                                                });
                                          
                                          var table2 = $('#example2').dataTable({
                                                                                ajax: {
                                                                                url:'/api/woffs',
                                                                                dataSrc: ''
                                                                                },
                                                                                columns: [
                                                                                          {data: 'writeoff_id'},
                                                                                          {data: 'tx_id'},
                                                                                          {data: 'cashier_address'},
                                                                                          {data: 'description'},
                                                                                          {data: function(source, type, val){
                                                                                          var dt = new Date(source.timestamp *1000);
                                                                                          return dt.toString();
                                                                                          }}
                                                                                          ]
                                                                                });
                                          $("#e1").click(function(){
                                                         $("#wt").hide();
                                                         $("#tt").show();
                                                         })
                                          $("#e2").click(function(){
                                                         $("#tt").hide();
                                                         $("#wt").show();
                                                         })
                                          
                                          
                                          });
                        </script>
                    
                </div>
                
                
                <!-- Chart code -->
                <script id="chartdiv" class="w3-show">
                    
                    var chartData = generateChartData();
                    
                    var chart = AmCharts.makeChart("chartdiv", {
                                                   "type": "serial",
                                                   "theme": "light",
                                                   "legend": {
                                                   "useGraphSettings": true
                                                   },
                                                   "dataProvider": chartData,
                                                   "synchronizeGrid":true,
                                                   "valueAxes": [{
                                                                 "id":"v1",
                                                                 "axisColor": "#FF6600",
                                                                 "axisThickness": 2,
                                                                 "axisAlpha": 1,
                                                                 "position": "left"
                                                                 }, {
                                                                 "id":"v2",
                                                                 "axisColor": "#FCD202",
                                                                 "axisThickness": 2,
                                                                 "axisAlpha": 1,
                                                                 "position": "right"
                                                                 }, {
                                                                 "id":"v3",
                                                                 "axisColor": "#B0DE09",
                                                                 "axisThickness": 2,
                                                                 "gridAlpha": 0,
                                                                 "offset": 50,
                                                                 "axisAlpha": 1,
                                                                 "position": "left"
                                                                 }],
                                                   "graphs": [{
                                                              "valueAxis": "v1",
                                                              "lineColor": "#FF6600",
                                                              "bullet": "round",
                                                              "bulletBorderThickness": 1,
                                                              "hideBulletsCount": 30,
                                                              "title": "支出",
                                                              "valueField": "visits",
                                                              "fillAlphas": 0
                                                              }, {
                                                              "valueAxis": "v2",
                                                              "lineColor": "#FCD202",
                                                              "bullet": "square",
                                                              "bulletBorderThickness": 1,
                                                              "hideBulletsCount": 30,
                                                              "title": "收入",
                                                              "valueField": "hits",
                                                              "fillAlphas": 0
                                                              }, {
                                                              "valueAxis": "v3",
                                                              "lineColor": "#B0DE09",
                                                              "bullet": "triangleUp",
                                                              "bulletBorderThickness": 1,
                                                              "hideBulletsCount": 30,
                                                              "title": "餘額",
                                                              "valueField": "views",
                                                              "fillAlphas": 0
                                                              }],
                                                   "chartScrollbar": {},
                                                   "chartCursor": {
                                                   "cursorPosition": "mouse"
                                                   },
                                                   "categoryField": "date",
                                                   "categoryAxis": {
                                                   "parseDates": true,
                                                   "axisColor": "#DADADA",
                                                   "minorGridEnabled": true
                                                   },
                                                   "export": {
                                                   "enabled": true,
                                                   "position": "bottom-right"
                                                   }
                                                   });
                                                   
                                                   chart.addListener("dataUpdated", zoomChart);
                                                   zoomChart();
                                                   
                                                   
                                                   // generate some random data, quite different range
                                                   function generateChartData() {
                                                       
                                                       var chartData = [];
                                                       var firstDate = new Date();
                                                       
                                                       firstDate.setDate(firstDate.getDate() - 100);
                                                       
                                                       for (var i = 0; i < 100; i++) {
                                                           
                                                           // we create date objects here. In your data, you can have date strings
                                                           // and then set format of your dates using chart.dataDateFormat property,
                                                           // however when possible, use date objects, as this will speed up chart rendering.
                                                           
                                                           var newDate = new Date(firstDate);
                                                           
                                                           newDate.setDate(newDate.getDate() + i);
                                                           
                                                           var pay = Math.round(Math.sin(i * 5) * i);
                                                           var get = Math.round(Math.random() * 80) + 500 + i * 3;
                                                           var rest = Math.round(Math.random() * 6000) + i * 4;
                                                           
                                                           pay = pay*pay
                                                           get = get*get
                                                           
                                                           chartData.push({
                                                                          
                                                                          date: newDate,
                                                                          visits: pay,
                                                                          hits: get,
                                                                          views: rest
                                                                          
                                                                          });
                                                                          
                                                                          
                                                       }
                                                       
                                                       return chartData;
                                                       
                                                   }
                
                function zoomChart(){
                    chart.zoomToIndexes(chart.dataProvider.length - 20, chart.dataProvider.length - 1);
                }
                
                    </script>
                
                </div>
                
                <script>
                    
                    function myFunction() {
                        var x = document.getElementById("chartdiv");
                        var y = document.getElementById("Demo");
                        
                        if (x.className.indexOf("w3-show") == -1) {
                            x.className += " w3-show";
                        }
                        
                        if (y.className.indexOf("w3-show") == -1) {}
                        else{
                            y.className = y.className.replace(" w3-show", "");
                        }
                    }
                
                function myFunctionTwo() {
                    var x = document.getElementById("chartdiv");
                    var y = document.getElementById("Demo");
                    
                    if (x.className.indexOf("w3-show") == -1) {}
                    else {
                        x.className = x.className.replace("w3-show", "w3-hide");
                        y.className += " w3-show";
                    }
                    
                    if (y.className.indexOf("w3-show") == -1) {
                        
                        y.className += " w3-show";
                    }
                }
                
                    </script>
                
                
            </body>
            
</html>
